# AGENTS.md — stop_midnight 作業ガイド

## コミュニケーションとワークフロー
- やり取りはすべて日本語で行う。
- 取り組むと決めたタスクは必ず `docs/logs/tasks` にTODOとして追加し、ログを更新する。
- 不明点や前提が曖昧な場合は必ずヒアリングしてから着手し、勝手に実装を進めない。
- 実装や仕様策定は段階的に進め、合意した範囲のみを扱う。

## プロダクトビジョン
- PWAとして実装し、最新のiOSでホーム画面に追加して利用できることを前提とする。
- 目的は「人間特有の夜中のバグ（直感的で快楽的な衝動）」を抑え、理性的に決めた夜の行動を継続できるようにすること。
- 避けたい誘惑（例: 闇カジノ、夜食、深酒など）はユーザーが最初に目標として設定し、後から変更できるようにする。

## コア体験（仮仕様）
1. **夜のプランニング**: 毎日22時前後にアプリが通知し、「今夜寝るまでに何をするか」を入力させる。目標に沿った行動を選びやすくする補助を用意する。
2. **夜間フィードバック**: 翌朝4時に再通知し、実際にやったことを振り返って記録する。寝てしまっていた場合も記録できるようにする。
3. **振り返りビュー**: カレンダー（またはタイムライン）形式で各日の「予定」と「実績」を一覧できるようにする。

## 補助機能の方向性
- 通知プラットフォームは Firebase Cloud Messaging(FCM) を前提とし、バックエンド/Functions等から予約送信を行う。
- 連続達成日数や「目標から外れなかったストリーク」を可視化する表示。
- 夜のプラン入力時に、過去の傾向に基づいた提案（例: 「先週は◎◎をしていました」「最近はこんなことをしています」）を提示するレコメンド機能。
- 避けたい誘惑別にログを集計し、「闇カジノ○日目」「夜食回避○日目」などのモチベーション指標を出せるようにする。
- ログを蓄積し、夜に決めたことと実績を簡単に参照できるようにする。


## タスク運用ルール
- アイデア段階のものは `docs/logs/tasks/*_backlog.md` として追加し、内容を固める。
- 着手に合意した作業は `*_todo.md` として登録し、進行状況を明文化する。
- 実装を行ったら `*_review.md` に移し、ユーザーの監査（レビュー）を待つ。
- ユーザーがレビューを通したら `*_done.md` に移す。
- ステータス変更はファイル名の末尾を変更し、`npm run logs-refresh` でビューを更新する。
- 新規タスク追加時は必ず直前に `npm run logs-refresh` を実行し、最新のIDを確認する。同時に複数人が作業する場合は事前に声をかけ、連番の重複がないよう調整する。万が一重複した場合は後から追加した側が未使用のIDでファイル名を付け直し、ログを更新する。

## 今後の進め方
- まずは上記アイデアを深掘りし、具体的なユーザーフローや画面構成、目標設定フローを固める。
- 仕様が確定した段階で設計・実装方針を定める。確定前にコードを書かない。
- 追加で検討したい事項や疑問点があれば、都度ユーザーに確認を取る。
